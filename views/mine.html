<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="/stylesheets/style.css">
    <link rel="stylesheet" href="/stylesheets/diary.css">
    <link rel="stylesheet" href="/stylesheets/mine.css">

</head>
<body>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <nav style="background-color: #495464;" class="navbar navbar-expand-md navbar-dark" aria-label="Fourth navbar example">
    <div class="container-fluid">
      <a class="navbar-brand" href="/index.html"><img src="/images/bufafood_logov2.png" class="brand-logo">  BUFA FOOD | 不發福</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
      </button>

      <!-- 把div的 class="collapse navbar-collapse justify-content-md-end" 拿掉，就可以達到置右對齊了 -->
      <div id="navbarsExample04">
        <ul class="navbar-nav me-auto mb-2 mb-md-0">
          <li class="nav-item">
            <a class="nav-link active" href="/search.html">食物庫</a>
          </li>
          <li class="nav-item">
            <a class="nav-link disabled">|</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="/mine.html">我的食物</a>
          </li>
          <li class="nav-item">
            <a class="nav-link disabled">|</a>
          </li>
          <li class="nav-item">
            <a class="active" href="/profile.html"><img src="/icons/member-mobile.png"></a>
          </li>

        </ul>
      </div>
    </div>
  </nav>
  
  <!-- <main class="d-flex flex-nowrap mt-5 mb-5"> -->
  <main class="d-flex flex-nowrap container-color">
    <div class="flex-shrink-0 p-3 sidebar-custom sidebar-color" style="width: 13EM;">
      <div class="sidebar mt-5">
        <a href="/index.html"><i class="fa fa-fw fa-home"></i> Home</a>
        <a href="/profile.html"><i class="fa fa-fw fa-wrench"></i> Profile</a>
        <a href="/diary.html"><i class="fa fa-fw fa-user"></i> Diary</a>
        <a href="/footprint.html"><i class="fa fa-fw fa-envelope"></i> Footprint</a>
      </div>
    </div>
    
    <div class="container col-lg-6 p-3">
      <div class="row column-style mt-5">
      <div style="justify-content: center;" class="col-12 diary-head">
        <div style="justify-content: center;" class="center-box">
          <h5 class="text-secondary">我的收藏</h5>
        </div> 
        <div id="my_collection" class="center-box">
          <!-- <div id="food_trend" style="margin: 30px 0px; display: flex; flex-wrap:wrap; justify-content: space-around;">
          </div> -->
          <div hidden>
          <div class="collection-card card text-dark bg-light mb-3" style="max-width: 15rem;">
            <!-- <div class="card-header">Header</div> -->
            <div class="card-body">
              <h6 class="card-title text-secondary"></h6>
            </div>
          </div>
          </div>
          <div class="display-data">
          </div>
        </div>
      </div>
      </div>
      
      <div class="row column-style">
        <div style="justify-content: center;" class="col-12 diary-head">
          <div style="justify-content: center;" class="center-box">
            <h5 class="text-secondary">我的建立清單</h5>
          </div> 
          <div id="created_by_me" class="center-box">
          </div>
        </div>
      </div>
    </div>  
  </main>

<div class="footer-dark">
  <footer>
      <div class="container">
          <div class="row">
              <div class="col-sm-6 col-md-3 item">
                  <h3>Services</h3>
                  <ul>
                      <li><a href="#">Web design</a></li>
                      <li><a href="#">Development</a></li>
                      <li><a href="#">Hosting</a></li>
                  </ul>
              </div>
              <div class="col-sm-6 col-md-3 item">
                  <h3>About</h3>
                  <ul>
                      <li><a href="#">Company</a></li>
                      <li><a href="#">Team</a></li>
                      <li><a href="#">Careers</a></li>
                  </ul>
              </div>
              <div class="col-md-6 item text">
                  <h3>BUFA FOOD</h3>
                  <p>Praesent sed lobortis mi. Suspendisse vel placerat ligula. Vivamus ac sem lacus. Ut vehicula rhoncus elementum. Etiam quis tristique lectus. Aliquam in arcu eget velit pulvinar dictum vel in justo.</p>
              </div>
              <!-- <div class="col item social"><a href="#"><i class="icon ion-social-facebook"></i></a><a href="#"><i class="icon ion-social-twitter"></i></a><a href="#"><i class="icon ion-social-snapchat"></i></a><a href="#"><i class="icon ion-social-instagram"></i></a></div> -->
          </div>
          <p class="copyright">BUFA FOOD © 2022</p>
      </div>
  </footer>
</div>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.min.js" integrity="sha384-lpyLfhYuitXl2zRZ5Bn2fqnhNAKOAaM/0Kr9laMspuaMiZfGmfwRNFh8HlMy49eQ" crossorigin="anonymous"></script>

<script>

  let accessToken = window.localStorage.getItem('accessToken');
  if (!accessToken) {
    alert('請先登入')
   window.location.href = `/index.html`
  //  return
  }else {
  // const webUrl = window.location.search
  // const splitUrl = webUrl.split('=')
  // let userId = splitUrl[1]
  const userId = window.localStorage.getItem('userId');
  async function getUserPreference(userId) {
    const collection = $('#my_collection')
    const record = await axios.get(`/api/1.0/user/preference?id=${userId}`, { headers: { Authorization: `Bearer ${accessToken}` } })
    // console.log('record', record);
    const preferenceRecord = record.data.preference.filter(e => e.collection === 1)
    // console.log('preferenceRecord', preferenceRecord)
    const len = preferenceRecord.length
    // for (let i = 0; i < len; i++) {
    //   let newDom = $('.collection-card').first().clone()
    //   newDom.children('.card-body')
    //   newDom.children('.card-body').children('.card-title').append(`${preferenceRecord[i].name}`)
    //   newDom.show()
    //   $('.display-data').append(newDom)
    // }

    /* 用for of 遍歷array */
    for (let foodObject of preferenceRecord) {
      let newDom = $('.collection-card').first().clone()
      newDom.children('.card-body')
      newDom.children('.card-body').children('.card-title').append(`${foodObject.name}`)
      newDom.show()
      $('.display-data').append(newDom)
    }
    // preferenceRecord.map(food =>
    // collection.append(`<a href="/detail.html?id=${food.food_id}"><div class="card text-dark bg-light mb-3" style="max-width: 15rem;"><div class="card-body"><h6 class="card-title text-secondary">${food.name}</h6></div></div></a>`)
    // )

  }
  getUserPreference(userId)
  }
</script>
</body>
</html>
