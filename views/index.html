<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="/stylesheets/style.css">

</head>
<body>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <nav style="background-color: #495464;" class="navbar navbar-expand-xl navbar-dark" aria-label="Fourth navbar example">
    <div class="container-fluid">
      <a class="navbar-brand" href="/index.html"><img src="/images/bufafood_logov2.png" class="brand-logo">  BUFA FOOD | 不發福</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- 把div的 class="collapse navbar-collapse justify-content-md-end" 拿掉，就可以達到置右對齊了 -->
      <div id="navbarsExample04">
        <ul class="navbar-nav me-auto mb-2 mb-md-0">
          <li class="nav-item">
            <a class="nav-link active" href="/search.html">食物庫</a>
          </li>
          <li class="nav-item">
            <a class="nav-link disabled">|</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="/mine.html">我的食物</a>
          </li>
          <li class="nav-item">
            <a class="nav-link disabled">|</a>
          </li>
          <li class="nav-item">
            <a class="active" href="/profile.html"><img src="/icons/member-mobile.png"></a>
          </li>

        </ul>
      </div>
    </div>
  </nav>
  
  <main class="container-color d-flex flex-nowrap">
  <!-- <div class="flex-shrink-0 p-3 sidebar-custom" style="width: 13EM;">
    <div class="sidebar">
      <a href="/index.html"><i class="fa fa-fw fa-home"></i> Home</a>
      <a href="/profile.html"><i class="fa fa-fw fa-wrench"></i> Profile</a>
      <a href="/diary.html"><i class="fa fa-fw fa-user"></i> Diary</a>
      <a href="/footprint.html"><i class="fa fa-fw fa-envelope"></i> Footprint</a>
    </div>
  </div> -->
  <div class="container mt-5 mb-5">
    <h2>WELCOME TO BUFA FOOD✨</h2>
    <!-- <button class="btn btn-outline-secondary col-4" type="button">Sign up</button>
    <button class="btn btn-outline-secondary col-4" type="button">Sign in</button> -->
  </div>
  <div class="container mt-5 mb-5">
    <div class="d-flex align-items-center h-custom-2 px-5 ms-xl-4 mt-5 pt-5 pt-xl-0 mt-xl-n5">

      <form style="width: 23rem;">
        <!-- <h3 class="fw-normal mb-3 pb-3" style="letter-spacing: 1px;">Log in</h3> -->

        <div class="form-outline mb-4">
          <label class="form-label" for="email">Email address</label>
          <input type="email" id="email" class="form-control form-control-m" />
        </div>

        <div class="form-outline mb-4">
          <label class="form-label" for="password">Password</label>
          <input type="password" id="password" class="form-control form-control-m" />
        </div>

        <div class="pt-1 mb-4">
          <button class="btn btn-outline-secondary col-4" type="button" id="signinBtn">Sign in</button>
          <!-- <p class="small mb-2 pb-lg-2"><a class="text-muted" href="#!">Forgot password?</a></p> -->
        </div>

        <a class="btn btn-primary btn-m btn-block mb-3" style="background-color: #3b5998" href="#!" role="button">
            <i class="fab fa-facebook-f me-2"></i>Continue with Facebook
          </a>
        <p>Don't have an account? <a href="#!" class="link-info">Register here</a></p>

      </form>
    </div>
  </div>
</main>

<div class="footer-dark">
  <footer>
      <div class="container">
          <div class="row">
              <div class="col-sm-6 col-md-3 item">
                  <h3>Services</h3>
                  <ul>
                      <li><a href="#">Web design</a></li>
                      <li><a href="#">Development</a></li>
                      <li><a href="#">Hosting</a></li>
                  </ul>
              </div>
              <div class="col-sm-6 col-md-3 item">
                  <h3>About</h3>
                  <ul>
                      <li><a href="#">Company</a></li>
                      <li><a href="#">Team</a></li>
                      <li><a href="#">Careers</a></li>
                  </ul>
              </div>
              <div class="col-md-6 item text">
                  <h3>BUFA FOOD</h3>
                  <p>Praesent sed lobortis mi. Suspendisse vel placerat ligula. Vivamus ac sem lacus. Ut vehicula rhoncus elementum. Etiam quis tristique lectus. Aliquam in arcu eget velit pulvinar dictum vel in justo.</p>
              </div>
              <!-- <div class="col item social"><a href="#"><i class="icon ion-social-facebook"></i></a><a href="#"><i class="icon ion-social-twitter"></i></a><a href="#"><i class="icon ion-social-snapchat"></i></a><a href="#"><i class="icon ion-social-instagram"></i></a></div> -->
          </div>
          <p class="copyright">BUFA FOOD © 2022</p>
      </div>
  </footer>
</div>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.min.js" integrity="sha384-lpyLfhYuitXl2zRZ5Bn2fqnhNAKOAaM/0Kr9laMspuaMiZfGmfwRNFh8HlMy49eQ" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/admin-lte@3.1/dist/js/adminlte.min.js"></script>
<script>
  $(document).ready(function(){
    $('#signinBtn').click(async function(){
    const email = $('#email').val()
    // console.log('email: ', email);
    const password = $('#password').val()
    // console.log('password: ', password);
    if( email =='' || password ==''){
      Swal.fire({
      icon: 'error',
      text: '請輸入完整帳號密碼'
    })
    return 
    }
    try {
    const data = await axios.post(`http://${location.host}/api/1.0/user/nativesignin`, { provider: 'native', email, password })
    // console.log('data: ', data);
    if (data.data.data.access_token) {
      const accessToken = data.data.data.access_token
      // console.log('accessToken: ', accessToken);
      Swal.fire({
          icon: 'success',
          title: '登入成功'
        })
      /* 輸入正確資訊時產生jwt token，進入user diary page */
      window.localStorage.setItem('accessToken', accessToken)
      window.localStorage.setItem('userName', data.data.data.user.name)
      window.localStorage.setItem('userId', data.data.data.user.id)
      window.localStorage.setItem('userEmail', data.data.data.user.email)
      const bodyInfo = await axios.get(`http://${location.host}/api/1.0/user/profile`, { headers: {Authorization: `Bearer ${accessToken}`} })
      // console.log('bodyInfo: ', bodyInfo);
      if (!bodyInfo.data.data.TDEE) return window.location.href = `http://${location.host}/target.html`
      return window.location.href = `http://${location.host}/profile.html`
    } else if(data.data.error){
        Swal.fire({
          icon: 'error',
          text: '帳號或密碼錯誤，請重新輸入'
        })
        return
      } 
    } catch (err) {
      console.error(err);
    }
  })
})

//   $(document).ready(function(){
//   $("#login").click(function(){
//     var email = $("#email").val();
//     var password = $("#password").val();
//     // Checking for blank fields. 檢查輸入欄位是否為空…
//     if( email =='' || password ==''){
//       $('input[type="text"],input[type="password"]').css("border","2px solid red");
//       $('input[type="text"],input[type="password"]').css("box-shadow","0 0 3px red");
//       alert("輸入的欄位不能是空的，請輸入適當的值...!!!!!!");
//     }else {
//       //以ajax方式將輸入的值丟給login.php，這個寫法跟我們之前用的方式更簡潔，花些時間理解一下。
//       $.post("login.php",{ email1: email, password1:password},
//       function(data) {
//         if(data=='無效的Email.......') { //從login.php傳回來的值(echo)，如果是…
//           $('input[type="text"]').css({"border":"2px solid red","box-shadow":"0 0 3px red"});
//           $('input[type="password"]').css({"border":"2px solid #00F5FF","box-shadow":"0 0 5px #00F5FF"});
//           alert(data);
//         }else if(data=='Email 或 密碼 是錯誤的...!!!!'){
//           $('input[type="text"],input[type="password"]').css({"border":"2px solid red","box-shadow":"0 0 3px red"});
//           alert(data);
//         } else if(data=='登入成功...'){
//           $("form")[0].reset();
//           $('input[type="text"],input[type="password"]').css({"border":"2px solid #00F5FF","box-shadow":"0 0 5px #00F5FF"});
//           //若需要的話，可把表單隱藏起來
//           // $(".main").hide();
//           alert(data);
//         } else{
//           alert(data);
//         }
//       });
//     }
//   });
// });
</script>
</body>
</html>
