<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/stylesheets/style.css">
</head>
<body>
  <script src="https://cdn.plot.ly/plotly-2.14.0.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/admin-lte@3.1/dist/js/adminlte.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <nav style="background-color: #4D555E;" class="navbar navbar-expand-md navbar-dark" aria-label="Fourth navbar example">
    <div class="container-fluid">
      <a class="navbar-brand" href="/index.html">BUFA FOOD | 不發福</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- 把div的 class="collapse navbar-collapse justify-content-md-end" 拿掉，就可以達到置右對齊了 -->
      <div id="navbarsExample04">
        <ul class="navbar-nav me-auto mb-2 mb-md-0">
          <li class="nav-item">
            <a class="nav-link active" href="/search.html">食物庫</a>
          </li>
          <li class="nav-item">
            <a class="nav-link disabled">|</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" href="/mine.html">我的食物</a>
          </li>
          <li class="nav-item">
            <a class="nav-link disabled">|</a>
          </li>
          <li class="nav-item">
            <a class="active" href="/profile.html"><img src="/icons/member-mobile.png"></a>
          </li>

        </ul>
      </div>
    </div>
  </nav>
  
  <main class="d-flex flex-nowrap mt-4 mb-4">
  <div class="flex-shrink-0 p-3 sidebar-custom" style="width: 13EM;">
    <div class="sidebar">
      <a href="/index.html"><i class="fa fa-fw fa-home"></i> Home</a>
      <a href="/profile.html"><i class="fa fa-fw fa-wrench"></i> Profile</a>
      <a href="/diary.html"><i class="fa fa-fw fa-user"></i> Diary</a>
      <a href="/footprint.html"><i class="fa fa-fw fa-envelope"></i> Footprint</a>
    </div>
  </div>
  
  <div class="container col-6 mt-4 mb-4">
      <div class="col-12 text-center" id="foodName"></div>
      <div class="card text-center">
        <div style="padding:5px" class="card-header">
          <ul style="justify-content: end; align-items: center;" class="nav nav-pills">
              <li class="nav-item">
                <img src="/icons/thumb_up.png" class="click_icon" id="thumb_up" onclick="updateInfo(this)">
              </li>
            <li class="nav-item">
              <img src="/icons/thumb_down.png" class="click_icon" id="thumb_down" onclick="updateInfo(this)">
            </li>
            <li class="nav-item">
              <img src="/icons/empty_heart.webp" class="click_icon" id="add_collection" onclick="updateInfo(this)">
            </li>
            <li class="nav-item">
              <img src="/icons/add.png" class="click_icon" id="add_diary" onclick="updateInfo(this)">
            </li>
          </ul>
        </div>
        <div class="card-body">
          <div class="row card-body-title">
            <!-- <div class="col-4"></div> -->
            <div class="col-12">
            <ul class="nav nav-pills detail-card-body">
              <li class="nav-card-title">
                <p class="text-secondary">每份量</p>
              </li>
              <li class="nav-card-title">
                <p class="text-secondary">熱量<br>kcal</br></p>
              </li>
              <li class="nav-card-title">
                <p class="text-secondary">碳水化合物</p>
              </li>
              <li class="nav-card-title">
                <p class="text-secondary">蛋白質</p>
              </li>
              <li class="nav-card-title">
                <p class="text-secondary">脂肪</p>
              </li>
            </ul>
            </div>
          </div>
          <div class="row card-body-title">
            <!-- <div class="col-4 text-secondary card-body-text"></div> -->
            <div class="col-12">
              <ul class="nav nav-pills detail-card-body">
                <li class="nav-card-title" id="foodServing">
                </li>
                <li class="nav-card-title" id="foodCalories">
                </li>
                <li class="nav-card-title" id="foodCarbs">
                </li>
                <li class="nav-card-title" id="foodProtein">
                </li>
                <li class="nav-card-title" id="foodFat">
                </li>
              </ul>
            </div>
          </div>
          <div class="row card-body-title">
            <div id="nutritionPie" style="width:100%; height:350px;"></div>
          </div>
        </div>
      </div>
    </div>
    </div>
  </div>
</main>

<div class="footer-dark">
  <footer>
      <div class="container">
          <div class="row">
              <div class="col-sm-6 col-md-3 item">
                  <h3>Services</h3>
                  <ul>
                      <li><a href="#">Web design</a></li>
                      <li><a href="#">Development</a></li>
                      <li><a href="#">Hosting</a></li>
                  </ul>
              </div>
              <div class="col-sm-6 col-md-3 item">
                  <h3>About</h3>
                  <ul>
                      <li><a href="#">Company</a></li>
                      <li><a href="#">Team</a></li>
                      <li><a href="#">Careers</a></li>
                  </ul>
              </div>
              <div class="col-md-6 item text">
                  <h3>BUFA FOOD</h3>
                  <p>Praesent sed lobortis mi. Suspendisse vel placerat ligula. Vivamus ac sem lacus. Ut vehicula rhoncus elementum. Etiam quis tristique lectus. Aliquam in arcu eget velit pulvinar dictum vel in justo.</p>
              </div>
              <div class="col item social"><a href="#"><i class="icon ion-social-facebook"></i></a><a href="#"><i class="icon ion-social-twitter"></i></a><a href="#"><i class="icon ion-social-snapchat"></i></a><a href="#"><i class="icon ion-social-instagram"></i></a></div>
          </div>
          <p class="copyright">BUFA FOOD © 2022</p>
      </div>
  </footer>
</div>

  <script>
  let webUrl = window.location.search;
  // console.log(webUrl);
  let splitUrl = webUrl.split('=');
  let foodId = splitUrl[1];
  if (!foodId) {
    window.location.href = `http://${location.host}/search.html`
  }
  // console.log('foodId', foodId);
  getFoodDetail(foodId)

  async function getFoodDetail(foodId) {
    const detail = await axios.get(`http://${location.host}/api/1.0/food/detail?id=${foodId}`)
    // console.log('detail', detail);
    if (detail.data.foodDetail.length === 0) {
      window.location.href = `http://${location.host}/search.html`
    }
    const foodDetailInfo = detail.data.foodDetail[0]
    // console.log('foodDetailInfo', foodDetailInfo)
    $('#foodName').append (`<h4 class="text-secondary">${foodDetailInfo.name}</h4`)
    $('#foodServing').append (`<p class="text-secondary">${foodDetailInfo.per_serving}g</p>`)
    $('#foodCalories').append (`<p class="text-secondary">${foodDetailInfo.calories}</p>`)
    $('#foodCarbs').append (`<p class="text-secondary">${foodDetailInfo.carbs}g</p>`)
    $('#foodProtein').append (`<p class="text-secondary">${foodDetailInfo.protein}g</p>`)
    $('#foodFat').append (`<p class="text-secondary">${foodDetailInfo.fat}g</p>`)
    const carbsPercentage = foodDetailInfo.carbs *4 /foodDetailInfo.calories
    const proteinPercentage = foodDetailInfo.protein *4 /foodDetailInfo.calories
    const fatPercentage = foodDetailInfo.fat *9 /foodDetailInfo.calories
    const pieData = [{
      values: [carbsPercentage, proteinPercentage, fatPercentage],
      labels: ['碳水化合物', '蛋白質', '脂肪'],
      type: 'pie',
      marker: {
        colors: ['#607D8B', '#9E9E9E', '#EF9A9A']
      }
    }];
    pie = document.querySelector('#nutritionPie')
    Plotly.newPlot(pie, pieData);
  } 

  // TODO: 可以把userId, foodId, btnId都包在 tag id裡，點選時便可以拆分id知道是要改變哪個使用者的偏好
  
  function updateInfo(iconBtn){
    alert($(iconBtn).attr('id'))
  }
  
  // $('#thumb_up').click(function() {
  //   const btn = $('#thumb_up').attr('id')
  //   alert('trigger worked!')
  // })  
  // $('#thumb_down').click(function() {
  //   alert('trigger worked!')
  // })  
  // $('#add_collection').click(function() {
  //   alert('trigger worked!')
  // })
  // $('#add_diary').click(function() {
  //   alert('trigger worked!')
  // })

  // 更新資料
  // async function updatepreference(foodId) {
  //   try {
  //     switch (btnId) {
  //       case 'thumb_up': btnValue = 
  //     }

  //     const data = { preference: `${btnValue}` }
  //     const updateInfo = await axios.patch(`http://${location.host}/api/1.0/food/detail?id=${foodId}`, data)
  //     console.log();
  //   } catch (err) {
  //     console.log(err)
  //   }
  // }

  </script>
</body>
</html>
